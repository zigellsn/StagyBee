{% extends 'base.html' %}
{% load i18n static %}

{% block title %}Stage{% endblock %}

{% block header %}
    {% include "stage/header.html" %}
{% endblock %}

{% block content %}
    <script type="text/hyperscript">
        def showMessage(msg)
            call Swal.fire({title: '{% trans "Nachricht" %}', text: msg, confirmButtonColor: '#3b82f6'})
            if result.isConfirmed or result.isDismissed then fetch {% url 'console:message_ack' credential.congregation %} {method:"POST", headers: { X-CSRFToken:"{{ csrf_token }}"}}
        end
        eventsource Alerts from http:/ws/console_client/{{ credential.congregation|escape }}/
            on alert as string
                showMessage(it)
            end
        end
    </script>

    <div hx-sse="connect:/ws/console_client/{{ credential.congregation|escape }}/">
        <div hx-sse="swap:scrim"></div>
    </div>
    <div hx-sse="connect:/ws/extractor/{{ credential.congregation|escape }}/">
        <div hx-sse="swap:sum-listeners"></div>
        <div hx-sse="swap:listeners"></div>
        <div hx-sse="swap:activity"></div>
    </div>
{% endblock %}

{% block footer %}
    <footer>
        {% if not credential.touch and credential.send_times_to_stage %}
            <div id="timer" class="flex justify-center">
            <div class="{% if LANGUAGE_BIDI %}rtl-progress{% endif %}" id="container">
            </div>

            <div hx-ws="connect:/ws/central_timer/{{ credential.congregation|escape }}/" class="progress">
                <div id="pb" class="progress-bar" style="width:0">
                </div>

                <div id="timer-overlay" class="flex flex-row text-xl self-center">
                    <span id="stopwatch" style="font-family: monospace;">00:00:00</span>
                    <span style="font-family: monospace;">&nbsp;|&nbsp;</span>
                    <span id="remaining" style="font-family: monospace;">00:00:00</span>
                </div>
            </div>
        {% endif %}
    </footer>
{% endblock %}

{% block body_extra %}
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}