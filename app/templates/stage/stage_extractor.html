{% extends 'base.html' %}
{% load i18n static %}

{% block title %}Stage{% endblock %}

{% block header %}
    {% include "stage/header.html" %}
{% endblock %}

{% block content %}
    <div hx-sse="connect:/ws/console_client/{{ credential.congregation|escape }}/">
        <div hx-sse="swap:scrim"></div>
    </div>

    <form id="alert-form" hx-trigger="confirm" hx-post="{% url 'console:message_ack' credential.congregation %}">
        <div _="
        on doIt(answer) log 'The answer is $answer'
        eventsource Alerts from http:/ws/console_client/{{ credential.congregation|escape }}/
            on alert as string
                call Swal.fire({title: '{% trans "Nachricht" %}', text: it})
                if result.isConfirmed trigger doIt(answer:42) end
            end
        end"></div>
        <input type="hidden" name="message" value="ACK">
    </form>


    {#    <div id="alert-box" class="info-box" data-role="infobox">#}
    {#        <div hx-sse="connect:/ws/console_client/{{ credential.congregation|escape }}/">#}
    {#            <div hx-sse="swap:alert"></div>#}
    {#        </div>#}
    {#        <form id="alert-form" hx-trigger="close from:#alert-box"#}
    {#              hx-post="{% url 'console:message_ack' credential.congregation %}">#}
    {#            <input type="hidden" name="message" value="ACK">#}
    {#        </form>#}
    {#    </div> #}
    <div hx-sse="connect:/ws/extractor/{{ credential.congregation|escape }}/">
        <div hx-sse="swap:sum-listeners"></div>
        <div hx-sse="swap:listeners"></div>
        <div hx-sse="swap:activity"></div>
    </div>
{% endblock %}

{% block footer %}
    <footer class="fixed-bottom">
        {% if not credential.touch and credential.send_times_to_stage %}
            <div id="timer" class="flex justify-center">
            <div class="{% if LANGUAGE_BIDI %}rtl-progress{% endif %}" id="container">
            </div>

            <div hx-ws="connect:/ws/central_timer/{{ credential.congregation|escape }}/" class="progress">
                <div id="pb" class="progress-bar" style="width:0">
                </div>

                <div id="timer-overlay" class="flex flex-row text-xl self-center">
                    <span id="stopwatch" style="font-family: monospace;">00:00:00</span>
                    <span style="font-family: monospace;">&nbsp;|&nbsp;</span>
                    <span id="remaining" style="font-family: monospace;">00:00:00</span>
                </div>
            </div>
        {% endif %}
    </footer>
{% endblock %}

{% block body_extra %}
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}