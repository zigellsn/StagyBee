{% extends 'base.html' %}
{% load i18n %}

{% block title %}Stage{% endblock %}

{% block header %}
    {% include "stage/header.html" %}
{% endblock %}

{% block content %}
    <div hx-ws="connect:/ws/console_client/{{ credential.congregation|escape }}/">
        <div id="scrim"></div>
    </div>
    <div hx-ws="connect:/ws/extractor/{{ credential.congregation|escape }}/">
        <div id="sum-listeners"></div>
        <div id="listeners"></div>
        <div class="pos-fixed pos-center" id="activity"></div>
    </div>
    <div id="alert-box" class="info-box" data-role="infobox" data-on-close="$('#alert-form').trigger('submit');">
        <div hx-ws="connect:/ws/console_client/{{ credential.congregation|escape }}/">
            <div id="alert"></div>
            <form id="alert-form" hx-ws="send">
                <input type="hidden" name="message" value="ACK">
            </form>
        </div>
    </div>
{% endblock %}

{% block footer %}
    <footer class="fixed-bottom">
        {% if not credential.touch and credential.send_times_to_stage %}
            <div id="timer" class="wrapper">
                <div class="{% if LANGUAGE_BIDI %}rtl-progress{% endif %}" id="container">
                </div>
                <div id="timer_overlay">
                    <samp class="text-leader" id="stopwatch">00:00:00</samp>
                    <samp class="text-leader">&nbsp;|&nbsp;</samp>
                    <samp class="text-leader" id="remaining">00:00:00</samp>
                </div>
            </div>
        {% endif %}
    </footer>
{% endblock %}

{% block body_extra %}
    <script>
        htmx.on("htmx:load", function (evt) {
            if (evt.target.id === 'alert')
                $('#alert-box').data('infobox').open();
        });
        StagyBee.main.timer_ws('{{ credential.congregation|escape }}', false, true);
    </script>
{% endblock %}